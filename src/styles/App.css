/* =========================================================
   App.css (PC版 / 3カラム + 固定盤面 + AutoScale対応)
   ========================================================= */

/* ========= Global ========= */
:root {
  --board-size: 1100px;
  --game-scale: 1;

  --side-width: 360px;
  --shell-gap: 20px;

  --panel-radius: 10px;
  --panel-pad: 0.6rem;
}

html,
body,
#root {
  width: 100%;
  height: 100%;
  margin: 0;
}

body {
  overflow: hidden; /* 外側は出さない（左右パネルは内部スクロール） */
  background: radial-gradient(#0c753e 0%, #064d2c 100%);
  font-family: 'Inter', sans-serif;
}

#root {
  position: relative;
  overflow: hidden;
}

/* ========= 3-column shell ========= */
.app-shell {
  display: grid;
  grid-template-columns: var(--side-width) minmax(0, 1fr) var(--side-width);
  gap: var(--shell-gap);
  padding: 16px;

  height: 100vh;
  align-items: start;
}

/* ========= Side panels ========= */
.side-ui {
  display: flex;
  flex-direction: column;
  gap: 12px;

  height: calc(100vh - 32px);
  overflow: auto;

  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  border-radius: var(--panel-radius);
  padding: var(--panel-pad);

  min-width: 0; /* これがないと中身が横にはみ出しやすい */
}

.left-ui {
  grid-column: 1;
}

/* 右カラム：上（ResultPanel）を伸縮、下（Debug）を固定表示 */
.right-ui {
  grid-column: 3;
  display: flex;
  flex-direction: column;
  min-width: 0;
  overflow-x: hidden; /* 横スクロールは絶対出さない */
}

.right-top {
  flex: 1 1 auto;
  min-height: 0; /* 重要：中身スクロールを効かせる */
  overflow: auto;
  overflow-x: hidden;
}

.right-bottom {
  flex: 0 0 auto;
  padding-top: 10px;
  border-top: 1px dashed rgba(255, 255, 255, 0.25);
}

.debug-row {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}

.debug-count {
  margin-left: auto;
  opacity: 0.9;
  white-space: nowrap;
}

/* ========= Center wrap (board holder) ========= */
.board-wrap {
  grid-column: 2;
  position: relative;

  /* 盤面以外のクリックを拾わない（固定盤面へ渡す） */
  pointer-events: none;

  /* 固定盤面が存在する前提で高さを確保（見た目安定） */
  min-height: calc(var(--board-size) * var(--game-scale));
}

/* ========= Game board (fixed + centered + scaled) ========= */
.game-board {
  width: var(--board-size);
  height: var(--board-size);

  position: fixed;
  left: 50%;
  top: 16px;

  transform-origin: top center;
  transform: translateX(-50%) scale(var(--game-scale));

  /* board-wrap が pointer-events:none なので盤面で復活 */
  pointer-events: auto;

  z-index: 10;
}

/* タイトル（ボード内座標） */
.title-in-board {
  position: absolute;
  top: 10px;
  left: 10px;
  font: 3rem/1 'Bebas Neue', sans-serif;
  color: #ffd700;
  text-shadow: 0 2px 4px #000;
  pointer-events: none;
}

/* ========= Card Slots ========= */
.card-slot-frame {
  position: absolute;
  border: 1px solid rgba(255, 255, 255, 0.7);
  border-radius: 6px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* ========= Place Bets Overlay ========= */
.place-bets-overlay {
  position: absolute;
  top: 30%;
  left: 33%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  font-weight: bold;
  color: #ffd700;
  text-shadow: 0 0 16px #000, 0 2px 6px #333;
  white-space: nowrap;
  padding: 0.2em 1em;
  border-radius: 1em;
  z-index: 1000;
  animation: fadeOut 1.3s linear forwards;
}

@keyframes fadeOut {
  0% {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
  }
  80% {
    opacity: 1;
  }
  100% {
    opacity: 0;
    transform: translate(-50%, -50%) scale(1.2);
  }
}

/* ===== mini cards (共通) ===== */
.mini-cards {
  display: flex;
  flex-wrap: nowrap; /* 縦に折り返さない */
  gap: 0; /* 余白殺す */
  align-items: center;
  justify-content: flex-start;
  min-width: 0;
}

.mini {
  width: 32px; /* Result側の標準サイズ */
  height: auto;
  margin: 0;
  display: inline-block; /* block禁止（縦積み回避） */
  vertical-align: middle;
  filter: drop-shadow(0 0 2px #0006);
}

/* ========= Result Panel ========= */
.result-panel {
  width: 100%;
  max-width: 100%;
  min-width: 0;

  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  border-radius: 10px;
  padding: 0.6rem;

  font-size: 0.8rem;

  /* 右にはみ出すのを防ぐ */
  overflow-x: hidden;
}

/* タブ */
.tab-header {
  display: flex;
  gap: 4px;
  margin-bottom: 6px;

  width: 100%;
  max-width: 100%;
  min-width: 0;
}

.tab-header button {
  flex: 1 1 0;
  min-width: 0;

  padding: 4px 0;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 4px 4px 0 0;
  cursor: pointer;
}

.tab-header button.active {
  background: #e67e22;
}

/* Result 内のテキストは基本折返しOK（FOLDとか長文対策） */
.result-panel p,
.result-panel .result-text,
.result-panel .message,
.result-panel .desc {
  margin: 0.35rem 0;
  line-height: 1.25;
  white-space: normal;
  overflow-wrap: anywhere; /* 長い文字列でも枠内で折る */
}

/* 「あなた：」「ディーラー：」の “ミニカード列” を必ず折り返す */
.result-panel .mini-cards,
.result-panel .hand-cards,
.result-panel .cards {
  display: flex;
  flex-wrap: wrap; /* ←これが要 */
  gap: 4px;
  align-items: center;
  justify-content: flex-start;

  min-width: 0;
  max-width: 100%;
}

/* Result側の mini は history と分離してサイズ指定 */
.result-panel .mini-cards .mini,
.result-panel img.mini {
  width: 26px; /* 24〜28で好み調整 */
  height: auto;
  display: block;
  margin: 0;
  flex: 0 0 auto;
}

/* 払い戻し詳細の“表っぽい行”を 2カラムで枠内に収める
   （クラス名が違っても効くように候補多め） */
.result-panel .payout-row,
.result-panel .row,
.result-panel .line,
.result-panel .kv,
.result-panel .breakdown-row {
  display: flex;
  gap: 10px;
  align-items: baseline;

  min-width: 0;
  max-width: 100%;
}

/* 左ラベル：縮む・省略OK */
.result-panel .payout-row > :first-child,
.result-panel .row > :first-child,
.result-panel .line > :first-child,
.result-panel .kv > :first-child,
.result-panel .breakdown-row > :first-child {
  flex: 1 1 auto;
  min-width: 0;

  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* 右金額：常に右寄せで切れない */
.result-panel .payout-row > :last-child,
.result-panel .row > :last-child,
.result-panel .line > :last-child,
.result-panel .kv > :last-child,
.result-panel .breakdown-row > :last-child {
  flex: 0 0 auto;
  white-space: nowrap;
  text-align: right;
}

/* table を使ってる場合も枠内固定 */
.result-panel table {
  width: 100%;
  max-width: 100%;
  table-layout: fixed;
  border-collapse: collapse;
}

.result-panel th,
.result-panel td {
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* “払い戻し詳細” ボックスがあるなら枠内に収める保険 */
.result-panel .payout-detail,
.result-panel .detail-box,
.result-panel .breakdown,
.result-panel .payout-box {
  max-width: 100%;
  min-width: 0;
  overflow-x: hidden;
}

/* ========= History (div+grid / 横スクロールゼロ / 切れない) ========= */

.history-list {
  width: 100%;
  max-width: 100%;
  min-width: 0;
  background: rgba(0, 0, 0, 0.85);
  color: #fff;
  border-radius: 8px;
  padding: 0.45rem;
  font-size: 0.76rem;
  overflow: hidden; /* 外側に横スクロールは出さない */
}

.history-title {
  margin: 0 0 0.35rem 0;
  font-size: 0.9rem;
  text-align: center;
}

.history-head,
.history-row {
  display: grid;

  /* ここが肝：全部 “固定＋1fr” で、必ずパネル幅に収まる */
  grid-template-columns:
    42px /* # + WIN/LOSE... */
    52px /* Player 2枚 */
    52px /* Dealer 2枚 */
    78px /* Board 5枚（15px*5=75） */
    46px; /* Payout */

  column-gap: 4px;
  align-items: center;

  width: 100%; /* ← max-content禁止。切れの原因 */
  justify-content: start;
}

.history-head {
  padding: 2px 2px;
  border: 1px solid rgba(255, 255, 255, 0.18);
  background: rgba(255, 255, 255, 0.08);
  font-size: 0.72rem;
}

.history-body {
  max-height: 560px;
  overflow-y: auto; /* 縦だけ */
  overflow-x: hidden; /* 横は絶対禁止 */
  border: 1px solid rgba(255, 255, 255, 0.18);
  border-top: none;
}

.history-row {
  padding: 2px 2px;
  border-top: 1px solid rgba(255, 255, 255, 0.12);
}

.h-col {
  min-width: 0;
}

.h-meta {
  text-align: center;
  line-height: 1.05;
}
.h-no {
  font-size: 0.78rem;
  opacity: 0.95;
}
.h-res {
  font-size: 0.64rem;
  opacity: 0.9;
}

.history-list .mini {
  width: 15px;
}

/* payout */
.h-pay {
  text-align: right;
  padding-right: 2px;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

.plus {
  color: #2ecc71;
}
.minus {
  color: #e74c3c;
}

/* 行カラー */
.history-row.win {
  background: rgba(46, 204, 113, 0.12);
}
.history-row.lose {
  background: rgba(52, 152, 219, 0.12);
}
.history-row.fold {
  background: rgba(241, 196, 15, 0.14);
}
.history-row.tie {
  background: rgba(189, 195, 199, 0.12);
}

/* 右カラムの横スクロール事故を保険で潰す */
.right-ui,
.right-top {
  overflow-x: hidden;
}

/* ========= Stats ========= */
.stats-box {
  background: #222;
  color: #fff;
  padding: 6px 10px;
  border-radius: 6px;
  margin-bottom: 4px;
  font-size: 1rem;
}

.stats-box ul {
  list-style: none;
  padding: 0;
  margin: 4px 0 0 0;
}

.stats-box li {
  margin: 2px 0;
}

/* ========= Misc ========= */
.bet-area.disabled {
  opacity: 0.4;
}

/* ========= Guide / Pointer ========= */
.guide-arrow {
  animation: arrowPulse 1.1s ease-in-out infinite;
}

@keyframes arrowPulse {
  0% {
    filter: drop-shadow(0 0 2px #00eaff);
    opacity: 0.95;
  }
  50% {
    filter: drop-shadow(0 0 10px #00eaff);
    opacity: 1;
  }
  100% {
    filter: drop-shadow(0 0 2px #00eaff);
    opacity: 0.95;
  }
}

/* ========= too-small ========= */
html.too-small::after {
  content: '画面が小さ過ぎます。\A ウィンドウを広げてください';
  white-space: pre;
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.75);
  color: #fff;
  font: 1.4rem/1.4 sans-serif;
  text-align: center;
  z-index: 6000;
  pointer-events: all;
}

/* ========= Responsive safety (PC寄り：崩れ防止) ========= */
@media (max-width: 1200px) {
  :root {
    --side-width: 320px;
  }
}
@media (max-width: 1060px) {
  :root {
    --side-width: 280px;
  }
}
